---
title: "Project"
author: "Eduardo Marenco"
subtitle: "Investigation into Chicago taxis"
echo: false
bibliography: references.bib
execute: 
  warning: false
fig-width: 6
fig-asp: 0.618
---

## Introduction

This is an exercise from the course on Data Visualization imparted by Professor Mine Cetinkaya and Professor Elijah Meyer at Duke University via Coursera. We will work with the data set taxi that contains information about tipping rates for 10,000 trips in the city of Chicago in 2022. The purpose of the exercise is to show proficiency in data exploration, data transformation, data visualization and statistical analysis based on two questions formulated by the Professors. First, I will upload the packages that I will use, then I will answer the two questions, and finally, I will answer a question formulated on my own.

## Packages 

```{r}
#| warning: false
#| message: false
library(tidyverse)
library(tidymodels)
library(scales)

```
First, I took a look at the data set to get a sense of the data using View(taxi), glimpse and ?taxi commands.

## Question 1

I used ggplot2 to visualize the relationship between the variables tip and distance.

```{r}
#| label: load-packages
# Load ggplot2 for enhanced data visualization
library(ggplot2)
```

A box plot suggests that there may be a relationship between the distance traveled and tips left. 

```{r}
#| label: distance-tip-boxplot
# Create the Box Plot using ggplot2
ggplot(taxi, aes(x = tip, y = distance, fill = tip)) +
  geom_boxplot() +
  labs(
    title = "Trip Distance Distribution by Tipping Status",
    x = "Tip Status",
    y = "Distance (miles)"
  ) +
  theme_minimal()
```

In fact, a density plot shows clearly that the distribution of tips concentrates below the 20 miles distance threshold, as shown below, where the peak for tipped trips (in red) is higher than for trips with no tip given.

```{r}
#| label: distance-tip-density plot
#| fig-cap: "Distribution of Trip Distance by Tipping Status"
ggplot(
  taxi,
  aes(x = distance, color = tip, fill = tip)
) +
  geom_density(alpha = 0.5)
```






A t test shows that the average distance for rides that received a tip was approximately 6.37 miles and that the the average distance for rides that did not receive a tip was approximately 4.57 miles. The mean distance for tipping rides is about 1.8 miles longer than non-tipping rides ($6.37 - 4.57$). 

```{r}
#| label: two-sample-t-test
# Perform the Two-Sample t-Test (Distance ~ Tip)
# The formula syntax is: <quantitative_variable> ~ <categorical_variable>
t_test_result <- t.test(distance ~ tip, data = taxi)

# Print the results of the t-test
print(t_test_result)
```
In conclusion, there is a statistically significant difference in the mean trip distance between rides that received a tip and those that did not. Customers are significantly more likely to leave a tip on longer trips compared to shorter ones. 

## Question 2 

We want to know if people tip the company Independents more than other companies based on the tips left to drivers from different companies. The following contingency table and bar plot shows that it looks that that may not be the case.

```{r}
#| label: company-tip-contingency tabl-bar plot
#Creating a Contingency Table to examine the variable
# This shows the counts for each combination of 'company' and 'tip'
contingency_table <- table(taxi$company, taxi$tip)
print(contingency_table)

# Visualizing Proportions (Optional but helpful)
# Convert to proportions within each company group to see the tipping rate
prop_table <- prop.table(contingency_table, margin = 1) # margin=1 for row proportions
print(prop_table)

# We want a color for 'yes' and a color for 'no'
tip_colors <- c("salmon", "turquoise3")

# Bar Plot for Visual Inspection
# A stacked bar plot or side-by-side bar plot can visually compare tipping rates
barplot(t(prop_table), beside = TRUE, 
        col = tip_colors, # Use the defined color vector
        legend.text = TRUE, 
        main = "Tipping Rate by Taxi Company", 
        ylab = "Proportion", 
        xlab = "Taxi Company")

# Add a title to the legend using the names of the 'tip' variable
legend("topright", legend = colnames(prop_table), fill = tip_colors, title = "Tip Status")
  
```

Next, I perform a Chi-squared test to examine the relationship between tip (a binary/dichotomous variable) and company (categorical). I created a new variable to compare Independents with the rest of companies. Based on the p-value obtained we can reject the null hypothesis that there is not association between the taxi company group (Independent vs others) and the tipping outcome and we can conclude that data strongly suggests that the tipping rate for Chicago Independents is significantly higher (94.88  percent) than for other companies (91.85 percent).

```{r}
#| label: company-tip-chi squared test
# Creating a new binary company variable: 'Independents' vs. 'Other'
taxi$independents_group <- ifelse(taxi$company == "Chicago Independents", "Chicago Independents", "Other")
# Check the new variable structure (optional)
table(taxi$independents_group)

# Creating the 2x2 contingency table (Independents vs. Other, Tip Yes vs. No)
indep_vs_other_table <- table(taxi$independents_group, taxi$tip)
print(indep_vs_other_table)

# 2. Perform the Chi-squared test on the 2x2 table
indep_chi_square_result <- chisq.test(indep_vs_other_table)
print(indep_chi_square_result)


```



## Your own question 


